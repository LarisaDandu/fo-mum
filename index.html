<!DOCTYPE html>
<html lang="ro">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Flower Reveal Gallery</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {
    position: relative;
    overflow: hidden;
    background: #FFFDB7;
    touch-action: none;
    margin: 0;
    font-family: sans-serif;
    padding: 60px 10px 20px 10px;
    color: rgb(59, 0, 59);
    z-index: 0;
  }

    .flower {
      position: absolute;
      cursor: grab;
      user-select: none;
      transition: transform 0.2s ease;
      z-index: 10;
    }

    .hidden { display: none; }

    /* Scrollable gallery container */
    #galleryContainer {
      position: relative;
      height: calc(100vh - 60px); 
      overflow-y: auto;
      padding: 0 10px 20px 10px;
      box-sizing: border-box;
      width: 100%;
      display: flex;
      justify-content: center;
    }

    .gallery {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
      gap: 10px;
      width: 100%;
      max-width: 900px;
      box-sizing: border-box;
    }

    .gallery img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      border-radius: 10px;
      cursor: pointer;
      box-shadow: 0 3px 6px rgba(0,0,0,0.2);
      transition: transform 0.2s ease;
    }

    .gallery img:hover { transform: scale(1.03); }

    .gallery img:first-child {
      grid-column: 1 / -1;
      height: 280px;
      object-fit: cover;
    }

    .gallery img:nth-child(3n) {
      grid-column: span 2;
      grid-row: span 2;
    }

    /* Modal */
    .modal {
      position: fixed;
      top: 0; left: 0;
      width: 100vw;
      height: 100vh;
      background: rgba(0,0,0,0.8);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 50;
      padding: 15px;
      box-sizing: border-box;
    }

    .modal-content {
      position: relative;
      max-width: 95vw;
      max-height: 90vh;
      background: white;
      border-radius: 12px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 10px;
      overflow: auto;
    }

    .modal-content img {
      width: 100%;
      height: auto;
      max-height: 80vh;
      object-fit: contain;
      border-radius: 12px;
    }

    .close-btn {
      position: absolute;
      top: 8px;
      right: 12px;
      font-size: 2rem;
      color: #fff;
      text-shadow: 0 0 6px rgba(0,0,0,0.6);
      cursor: pointer;
      z-index: 60;
    }

    /* Instruction box */
    .instruction {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: #E6E6FA;
      padding: 15px 20px;
      border-radius: 10px;
      font-weight: 600;
      text-align: center;
      box-shadow: 0 3px 10px rgba(0,0,0,0.2);
      cursor: grab;
      z-index: 15;
      max-width: 80%;
      opacity: 0;
      animation: fadeIn 1s forwards;
    }

    @keyframes fadeIn {
      to { opacity: 1; }
    }

    /* Video */
  video {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 100vw;
    height: 100vh;
    object-fit: cover;
    z-index: 1;
    border: none;
  }
    h1 {
    position: absolute;
    top: 6%;
    z-index: 20;
    text-align: center;
    text-shadow: 0 3px 6px rgba(0,0,0,0.3);
    font-weight: bold;
  }

    /* Transparent container above video */
  #overlayTitle {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100vh;
    display: flex;
    align-items: center;
    justify-content: center;
    pointer-events: none; /* lets clicks pass to video */
    z-index: 2;
  }

  /* Title text inside overlay */
  #overlayTitle h1 {
    color: rgb(59, 0, 59);
    font-size: 1.8rem;
    font-weight: bold;
    text-align: center;
    text-shadow: 0 2px 6px rgba(255,255,255,0.8);
    pointer-events: none; /* text never blocks tap */
    padding: 0 10px;
  }
  </style>
</head>
<body>

  <!-- Title -->
  <div id="overlayTitle">
    <h1 id="title">Apasă pe fundiță pentru a desface buchetul.</h1>
  </div>

  <!-- Video -->
  <video id="introVideo" playsinline>
    <source src="media/video/bouquet_open.mp4" type="video/mp4" poster="media/video/poster.jpg">
    Your browser does not support video.
  </video>

  <!-- Scrollable gallery container -->
  <div id="galleryContainer" class="hidden">
    <div id="gallery" class="gallery"></div>
  </div>

  <!-- Modal -->
  <div id="modal" class="modal hidden">
    <div class="modal-content">
      <span id="closeModal" class="close-btn">&times;</span>
      <img id="modalImg" src="" alt="Full view" />
      <p id="modalDesc" class="mt-3 mb-4 text-center text-gray-700 text-sm px-3"></p>
    </div>
  </div>

  <!-- Instruction box -->
  <div id="instruction" class="instruction hidden">
    Dă florile și textul la o parte pentru a dezvălui adevăratele flori.
  </div>

  <script>

  function resizeVideo() {
  const video = document.getElementById('introVideo');
  if (!video) return;
  video.style.width = window.innerWidth + 'px';
  video.style.height = window.innerHeight + 'px';
  }

  window.addEventListener('resize', resizeVideo);
  window.addEventListener('orientationchange', resizeVideo);
  window.addEventListener('load', resizeVideo);  

  const video = document.getElementById('introVideo');
  const title = document.getElementById('title');
  const galleryContainer = document.getElementById('galleryContainer');
  const gallery = document.getElementById('gallery');
  const modal = document.getElementById('modal');
  const modalImg = document.getElementById('modalImg');
  const modalDesc = document.getElementById('modalDesc');
  const closeModal = document.getElementById('closeModal');
  const instruction = document.getElementById('instruction');
  const flowers = [];

  const flowerSources = Array.from({ length: 21 }, (_, i) => `media/flowers/flower${i + 1}.svg`);
  const galleryImages = Array.from({ length: 55 }, (_, i) => ({
    src: `media/gallery/photo${i + 1}.jpg`,
  }));

  video.addEventListener('click', () => video.play());

  video.addEventListener('ended', () => {
    title.classList.add('hidden');
    video.classList.add('hidden');
    galleryContainer.classList.remove('hidden');
    spawnFlowers();
    loadGallery();
    instruction.classList.remove('hidden');
    makeDraggable(instruction);
  });

  function spawnFlowers() {
    const numFlowers = 21;
    const screenW = window.innerWidth;
    const screenH = window.innerHeight;

    for (let i = 0; i < numFlowers; i++) {
      const f = document.createElement('img');
      f.src = flowerSources[i % flowerSources.length];
      f.classList.add('flower');

      const scale = 1.2 + Math.random() * 1.2;
      const size = 400 * scale;
      f.style.width = `${size}px`;
      f.style.height = `${size}px`;

      const x = Math.random() * screenW -200;
      const y = Math.random() * screenH - 200;
      f.style.left = `${x}px`;
      f.style.top = `${y}px`;

      document.body.appendChild(f);
      makeDraggable(f, true);
      flowers.push(f);
    }
  }

  // smoother, easier dragging with swipe-away
  function makeDraggable(el, isFlower = false) {
    let offsetX = 0, offsetY = 0, dragging = false;
    let startX = 0, startY = 0, lastX = 0, lastY = 0, startTime = 0;

    el.addEventListener('pointerdown', e => {
      dragging = true;
      el.style.cursor = 'grabbing';
      offsetX = e.clientX - el.offsetLeft;
      offsetY = e.clientY - el.offsetTop;
      startX = e.clientX;
      startY = e.clientY;
      lastX = e.clientX;
      lastY = e.clientY;
      startTime = Date.now();
      el.setPointerCapture(e.pointerId);
    });

    el.addEventListener('pointermove', e => {
      if (!dragging) return;
      const dx = e.clientX - offsetX;
      const dy = e.clientY - offsetY;
      el.style.left = dx + 'px';
      el.style.top = dy + 'px';
      lastX = e.clientX;
      lastY = e.clientY;
    });

    el.addEventListener('pointerup', e => {
      if (!dragging) return;
      dragging = false;
      el.style.cursor = 'grab';

      const elapsed = Date.now() - startTime;
      const velocityX = (e.clientX - startX) / elapsed;
      const velocityY = (e.clientY - startY) / elapsed;
      const distanceEdge = Math.min(
        e.clientX, window.innerWidth - e.clientX,
        e.clientY, window.innerHeight - e.clientY
      );

      // if flicked fast or near edge, swoosh away
      if (isFlower && (Math.abs(velocityX) > 0.5 || Math.abs(velocityY) > 0.5 || distanceEdge < 80)) {
        swooshAway(el, velocityX, velocityY);
      }
    });
  }

  function swooshAway(el, vx, vy) {
    const flyX = vx * 2000 || (Math.random() - 0.5) * 2000;
    const flyY = vy * 2000 || (Math.random() - 0.5) * 2000;

    el.style.transition = 'transform 1s ease-out, opacity 1s ease-out';
    el.style.transform = `translate(${flyX}px, ${flyY}px) rotate(${Math.random() * 720 - 360}deg)`;
    el.style.opacity = '0';

    setTimeout(() => {
      if (el.parentNode) el.parentNode.removeChild(el);
    }, 1000);
  }

  function loadGallery() {
    gallery.innerHTML = '';
    galleryImages.forEach(item => {
      const img = document.createElement('img');
      img.src = item.src;
      img.alt = 'Gallery image';
      img.addEventListener('click', () => openModal(item.src, item.desc));
      gallery.appendChild(img);
    });
  }

  function openModal(src, desc) {
    modalImg.src = src;
    modalDesc.textContent = desc;
    modal.classList.remove('hidden');
  }

  closeModal.addEventListener('click', () => modal.classList.add('hidden'));
  modal.addEventListener('click', e => {
    if (e.target === modal) modal.classList.add('hidden');
  });
</script>

